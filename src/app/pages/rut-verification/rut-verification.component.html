<div class="verification-container" (click)="resetInactivityTimer()" (keydown)="resetInactivityTimer()">
  <!-- Estado de la impresora - Esquina superior derecha -->
  <div class="printer-status-badge" [ngClass]="printerStatus">
    <span class="status-dot"></span>
    <span class="status-text">
      @if (printerStatus === 'online') {
        Impresora lista
      } @else if (printerStatus === 'offline') {
        Impresora offline
      } @else {
        Verificando...
      }
    </span>
  </div>

  <!-- Vista principal de verificación -->
  <div class="main-view" *ngIf="!empleado">
    <!-- Header -->
    <div class="header">
      <div class="logo-container">
        <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" fill="currentColor"/>
        </svg>
      </div>
      <h1>Sistema de Control de Tickets de Casino</h1>
    </div>

    <!-- Display del RUT -->
    <div class="rut-display-container">
      <div class="rut-display">
        {{ rutFormateado || '_ _ _ _ _ _ _ _ - _' }}
      </div>
    </div>

    <!-- Teclado Numérico -->
    <div class="numpad-container">
      <div class="numpad-grid">
        <button class="numpad-btn" (click)="agregarDigito('1')" [disabled]="verificando || imprimiendo">1</button>
        <button class="numpad-btn" (click)="agregarDigito('2')" [disabled]="verificando || imprimiendo">2</button>
        <button class="numpad-btn" (click)="agregarDigito('3')" [disabled]="verificando || imprimiendo">3</button>
        
        <button class="numpad-btn" (click)="agregarDigito('4')" [disabled]="verificando || imprimiendo">4</button>
        <button class="numpad-btn" (click)="agregarDigito('5')" [disabled]="verificando || imprimiendo">5</button>
        <button class="numpad-btn" (click)="agregarDigito('6')" [disabled]="verificando || imprimiendo">6</button>
        
        <button class="numpad-btn" (click)="agregarDigito('7')" [disabled]="verificando || imprimiendo">7</button>
        <button class="numpad-btn" (click)="agregarDigito('8')" [disabled]="verificando || imprimiendo">8</button>
        <button class="numpad-btn" (click)="agregarDigito('9')" [disabled]="verificando || imprimiendo">9</button>
        
        <button class="numpad-btn" (click)="agregarDigito('0')" [disabled]="verificando || imprimiendo">0</button>
        <button class="numpad-btn" (click)="agregarDigito('-')" [disabled]="verificando || imprimiendo">-</button>
        <button class="numpad-btn" (click)="agregarDigito('K')" [disabled]="verificando || imprimiendo">K</button>
      </div>

      <!-- Botón de borrar -->
      <button class="btn-clear" (click)="borrarUltimoDigito()" [disabled]="verificando || imprimiendo || rut.length === 0">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-3 12.59L17.59 17 14 13.41 10.41 17 9 15.59 12.59 12 9 8.41 10.41 7 14 10.59 17.59 7 19 8.41 15.41 12 19 15.59z" fill="currentColor"/>
        </svg>
        Borrar
      </button>
    </div>

    <!-- Mensaje de error -->
    <div class="error-message" *ngIf="errorMensaje">
      <svg class="error-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" fill="currentColor"/>
      </svg>
      {{ errorMensaje }}
    </div>

    <!-- Link a credenciales alternativas -->
    <div class="alternative-access">
      <a href="#" class="link-credential">Utilizar Credencial</a>
    </div>

    <!-- Botón Siguiente -->
    <div class="action-container">
      <button 
        class="btn-siguiente"
        (click)="verificarRut()"
        [disabled]="verificando || imprimiendo || rut.length < 8"
        [class.loading]="verificando || imprimiendo"
      >
        @if (verificando) {
          <span class="spinner"></span>
          <span>Verificando...</span>
        } @else if (imprimiendo) {
          <span class="spinner"></span>
          <span>Imprimiendo...</span>
        } @else {
          SIGUIENTE
        }
      </button>
    </div>
  </div>

  <!-- Vista de resultado exitoso -->
  <div class="result-view" *ngIf="empleado">
    <div class="success-card">
      <div class="success-header">
        <svg class="success-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
        </svg>
        <h2>Ticket Verificado</h2>
      </div>

      <div class="employee-info">
        <div class="info-item">
          <span class="info-label">Nombre</span>
          <span class="info-value">{{ empleado.nombre }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">RUT</span>
          <span class="info-value">{{ casinoService.formatearRut(empleado.rut) }}</span>
        </div>
        <div class="info-item highlight">
          <span class="info-label">Opciones Disponibles</span>
          <span class="info-value">{{ empleado.opcionesDisponibles.join(', ') }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Turno</span>
          <span class="info-value">{{ empleado.turno }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Área</span>
          <span class="info-value">{{ empleado.area }}</span>
        </div>
      </div>

      <!-- Estado de impresión -->
      @if (imprimiendo) {
        <div class="print-status printing">
          <div class="print-icon">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z" fill="currentColor"/>
            </svg>
          </div>
          <p class="print-message">Imprimiendo ticket...</p>
          <div class="progress-bar">
            <div class="progress-fill"></div>
          </div>
        </div>
      } @else if (ticketImpreso) {
        <div class="print-status success">
          <div class="print-icon">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
            </svg>
          </div>
          <p class="print-message">¡Ticket impreso exitosamente!</p>
          <p class="print-submessage">Retire su ticket de la impresora</p>
        </div>
      }

      <!-- Botones de acción -->
      <div class="result-actions">
        <button 
          class="btn-action btn-retry"
          *ngIf="!ticketImpreso && !imprimiendo && printerStatus === 'online'"
          (click)="imprimirTicket()"
        >
          Reintentar Impresión
        </button>
        
        <button 
          class="btn-action btn-primary"
          (click)="resetearFormulario()"
        >
          Nueva Verificación
        </button>
      </div>
    </div>
  </div>

  <!-- Tiempo restante de inactividad (solo visible en desarrollo) -->
  <div class="inactivity-indicator" *ngIf="showInactivityTimer && tiempoRestante < 60">
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" fill="currentColor"/>
    </svg>
    <span>Reset en {{ tiempoRestante }}s</span>
  </div>
</div>
